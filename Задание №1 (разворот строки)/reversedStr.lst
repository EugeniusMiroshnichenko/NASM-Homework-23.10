     1                                  section .text
     2                                  
     3                                  global _start
     4                                  
     5                                  _start:
     6                                      ; Входное сообщение
     7 00000000 B801000000                  mov rax, 0x1
     8 00000005 BF01000000                  mov rdi, 0x1
     9 0000000A 48BE-                       mov rsi, inMes
     9 0000000C [0000000000000000] 
    10 00000014 BA0D000000                  mov rdx, inMesLen
    11 00000019 0F05                        syscall
    12                                  
    13 0000001B 4883F80D                    cmp rax, inMesLen ; rax не меняется, код ошибки не теряем, если она есть
    14 0000001F 0F8CF0000000                JL errorSection ; % Выведено меньше символов, чем ожидалось (если есть ошибка, то результат автоматически будет отрицательным)
    15                                  
    16                                      ; Считываем строку
    17 00000025 B800000000                  mov rax, 0
    18 0000002A BF00000000                  mov rdi, 0
    19 0000002F 48BE-                       mov rsi, string
    19 00000031 [1E00000000000000] 
    20 00000039 488B1425[83000000]          mov rdx, [str_len]
    21 00000041 0F05                        syscall
    22                                      
    23 00000043 4883F800                    cmp rax, 0
    24 00000047 0F8CC8000000                JL errorSection; 0 символов - не ошибка. Значит ошибка только отрицательное число
    25 0000004D 0F84E9000000                JE exitSection
    26                                  
    27 00000053 48890425[83000000]          mov [str_len], rax
    28 0000005B 48BB-                       mov rbx, string
    28 0000005D [1E00000000000000] 
    29 00000065 48BE-                       mov rsi, reversed_str
    29 00000067 [0000000000000000] 
    30 0000006F 488B1425[83000000]          mov rdx, [str_len]
    31 00000077 E86C000000                  call reverse_string
    32                                  
    33                                      ; Выходное сообщение
    34 0000007C B801000000                  mov rax, 0x1
    35 00000081 BF01000000                  mov rdi, 0x1
    36 00000086 48BE-                       mov rsi, outMes
    36 00000088 [0D00000000000000] 
    37 00000090 BA10000000                  mov rdx, outMesLen
    38 00000095 0F05                        syscall
    39                                  
    40 00000097 4883F810                    cmp rax, outMesLen ; rax не меняется, код ошибки не теряем, если она есть
    41 0000009B 7C78                        JL errorSection ; % Выведено меньше символов, чем ожидалось (если есть ошибка, то результат автоматически будет отрицательным)
    42                                  
    43                                      ; Выводим перевернутую строку
    44 0000009D B801000000                  mov rax, 0x1
    45 000000A2 BF01000000                  mov rdi, 0x1
    46 000000A7 48BE-                       mov rsi, reversed_str
    46 000000A9 [0000000000000000] 
    47 000000B1 488B1425[83000000]          mov rdx, [str_len]
    48 000000B9 0F05                        syscall
    49                                      
    50 000000BB 483B0425[83000000]          cmp rax, [str_len] ; rax не меняется, код ошибки не теряем, если она есть
    51 000000C3 7C50                        JL errorSection ; % Выведено меньше символов, чем ожидалось (если есть ошибка, то результат автоматически будет отрицательным)
    52                                   
    53                                      ; Новая строка
    54 000000C5 B801000000                  mov rax, 0x1
    55 000000CA BF01000000                  mov rdi, 0x1
    56 000000CF 48BE-                       mov rsi, newLine
    56 000000D1 [1D00000000000000] 
    57 000000D9 BA01000000                  mov rdx, newLineLen
    58 000000DE 0F05                        syscall
    59                                  
    60 000000E0 4883F801                    cmp rax, newLineLen ; rax не меняется, код ошибки не теряем, если она есть
    61 000000E4 7C2F                        JL errorSection ; % Выведено меньше символов, чем ожидалось (если есть ошибка, то результат автоматически будет отрицательным)   
    62                                      
    63                                      ; Завершаем работу
    64 000000E6 EB54                        JMP exitSection
    65                                  
    66                                  
    67                                  reverse_string:
    68                                      ; rdx хранит длину строки
    69                                      ; rbx - ссылку на исходную строку (на входе), 
    70                                      ; rsi - сслыку на перевернутую строку
    71                                      ; rcx - счётчик
    72                                      
    73 000000E8 B900000000                  mov rcx, 0 ; обнуляем счетчик (на всякий случай)
    74                                  
    75 000000ED 4989D8                      mov r8, rbx ; сохраняем начало исходной строки в r8, чтобы не съехал указатель
    76 000000F0 4801D3                      add rbx, rdx ; rdi указывает на конец исходной строки
    77 000000F3 48FFCB                      dec rbx ; корректируем на последний символ
    78                                    
    79                                      ; Проверяем и удаляем \n если есть
    80 000000F6 803B0A                      cmp byte [rbx], 10
    81 000000F9 7509                        jne .loop
    82 000000FB C60300                      mov byte [rbx], 0
    83 000000FE 48FFCA                      dec rdx           ; уменьшаем длину строки
    84 00000101 48FFCB                      dec rbx           ; переходим к предыдущему символу
    85                                      
    86                                  .loop:
    87 00000104 8A03                        mov al, [rbx] ; символ с текущего конца исходной строки 
    88 00000106 88040E                      mov [rsi + rcx], al ; помещаем символ в перевернутую строку (движемся с начала) 
    89 00000109 48FFCB                      dec rbx ; смещаем конец исходной строки
    90 0000010C 48FFC1                      inc rcx ; увеличиваем счётчик
    91 0000010F 4839D1                      cmp rcx, rdx ; проврека на выход за границы
    92 00000112 72F0                        jb .loop
    93                                      
    94 00000114 C3                          ret
    95                                  
    96                                  
    97                                  errorSection:
    98                                      ; Вывелись не все символы на экран или есть ошибка
    99                                      ; Код ошибки лежим в rax, здесь возможна какая-то дополнительная логика
   100 00000115 B801000000                  mov rax, 0x1
   101 0000011A BF02000000                  mov rdi, 0x2
   102 0000011F 48BE-                       mov rsi, erMsg
   102 00000121 [8700000000000000] 
   103 00000129 BA1E000000                  mov rdx, erMsgLen
   104 0000012E 0F05                        syscall
   105                                      
   106 00000130 B83C000000                  mov rax, 0x3c
   107 00000135 BF01000000                  mov rdi, 0x1
   108 0000013A 0F05                        syscall
   109                                  
   110                                  exitSection:
   111 0000013C B83C000000                  mov rax, 0x3c
   112 00000141 BF00000000                  mov rdi, 0x0
   113 00000146 0F05                        syscall
   114                                  
   115                                  section .data
   116 00000000 456E74657220737472-         inMes db "Enter string:"
   116 00000009 696E673A           
   117                                      inMesLen equ $ - inMes
   118 0000000D 526576657273656420-         outMes db "Reversed string:"
   118 00000016 737472696E673A     
   119                                      outMesLen equ $ - outMes
   120 0000001D 0A                          newLine db 10
   121                                      newLineLen equ $ - newLine
   122 0000001E 00<rep 65h>                 string times 101 db 0     ; Исходная строка (100 символов + \n)
   123 00000083 00000000                    str_len dd 0            ; Длина введенной строки
   124 00000087 4572726F7220686170-         erMsg db "Error happed during writing!", "\n"
   124 00000090 70656420647572696E-
   124 00000099 672077726974696E67-
   124 000000A2 215C6E             
   125                                      erMsgLen equ $ - erMsg
   126                                  
   127                                  section .bss
   128 00000000 <res 65h>                   reversed_str resb 101  ; Буфер для перевернутой строки (100 символов + \n)
   129                                  
   130                                  
   131                                  
